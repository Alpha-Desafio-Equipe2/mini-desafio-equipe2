<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema Farmácia Popular | Professional</title>
    <!-- CSS Externo -->
    <link href="styles/global.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div
      id="mobile-overlay"
      class="mobile-overlay"
      onclick="toggleSidebar()"
    ></div>
    <!-- LAYOUT PRINCIPAL -->
    <section id="app-layout" class="hidden">
      <!-- SIDEBAR -->
      <nav class="sidebar" id="sidebar">
        <div class="brand">
          <i class="fas fa-plus-square"></i>
          <span>FarmaPro</span>
          <button
            class="btn btn-outline"
            onclick="toggleSidebar()"
            style="margin-left: auto; padding: 5px 10px; display: none"
            id="mobile-close-btn"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <a href="#" class="nav-item active" onclick="navegar('dashboard', this)"
          ><i class="fas fa-chart-line" style="width: 25px"></i
          ><span>Dashboard</span></a
        >
        <a href="#" class="nav-item" onclick="navegar('vendas', this)"
          ><i class="fas fa-cash-register" style="width: 25px"></i
          ><span>PDV (Caixa)</span></a
        >
        <a href="#" class="nav-item" onclick="navegar('medicamentos', this)"
          ><i class="fas fa-pills" style="width: 25px"></i
          ><span>Medicamentos</span></a
        >
        <a href="#" class="nav-item" onclick="navegar('historico', this)"
          ><i class="fas fa-history" style="width: 25px"></i
          ><span>Histórico</span></a
        >
        <a href="#" class="nav-item" onclick="navegar('cadastros', this)"
          ><i class="fas fa-users" style="width: 25px"></i
          ><span>Cadastros</span></a
        >
        <a href="#" class="nav-item logout" onclick="logout()"
          ><i class="fas fa-sign-out-alt" style="width: 25px"></i
          ><span>Sair</span></a
        >
      </nav>

      <!-- CONTEÚDO -->
      <main class="main-content">
        <!-- DASHBOARD -->
        <div id="screen-dashboard" class="screen">
          <header>
            <div class="header-title-group">
              <button
                id="menu-toggle-btn"
                class="btn"
                onclick="toggleSidebar()"
              >
                <i class="fas fa-bars"></i>
              </button>
              <h1>Visão Geral</h1>
            </div>
            <div class="user-info">
              <i class="fas fa-user-circle"></i> Olá, <b>Farmacêutico(a)</b>
            </div>
          </header>
          <div class="dashboard-grid">
            <div
              class="table-container"
              style="
                border-left: 5px solid var(--primary);
                padding: 15px;
                margin-bottom: 0;
              "
            >
              <h4 style="color: #666">Vendas Hoje</h4>
              <p style="font-size: 1.8rem; font-weight: bold" id="dash-total">
                R$ 0,00
              </p>
            </div>
            <div
              class="table-container"
              style="
                border-left: 5px solid var(--secondary);
                padding: 15px;
                margin-bottom: 0;
              "
            >
              <h4 style="color: #666">Atendimentos</h4>
              <p
                style="font-size: 1.8rem; font-weight: bold"
                id="dash-atendimentos"
              >
                0
              </p>
            </div>
            <div
              class="table-container"
              style="
                border-left: 5px solid var(--danger);
                padding: 15px;
                margin-bottom: 0;
              "
            >
              <h4 style="color: #666">Estoque Crítico</h4>
              <p style="font-size: 1.8rem; font-weight: bold" id="dash-critico">
                1
              </p>
            </div>
            <div
              class="table-container"
              style="
                border-left: 5px solid var(--warning);
                padding: 15px;
                margin-bottom: 0;
              "
            >
              <h4 style="color: #666">Controlados</h4>
              <p
                style="font-size: 1.8rem; font-weight: bold"
                id="dash-controlados"
              >
                0
              </p>
            </div>
          </div>
          <div class="table-container">
            <h3><i class="fas fa-bullhorn"></i> Avisos do Sistema</h3>
            <div
              style="
                padding: 15px;
                background: #fff3cd;
                border-radius: 4px;
                margin-top: 10px;
                color: #856404;
              "
            >
              <strong>Atenção:</strong> O lote de <b>Amoxicilina 500mg</b> está
              com estoque baixo (5 unidades). Realizar pedido de compra.
            </div>
          </div>
        </div>

        <!-- MEDICAMENTOS -->
        <div id="screen-medicamentos" class="screen hidden">
          <header>
            <div class="header-title-group">
              <button
                class="btn"
                onclick="toggleSidebar()"
                style="background: none; border: 1px solid #ddd"
              >
                <i class="fas fa-bars"></i>
              </button>
              <h1>Estoque</h1>
            </div>
            <button class="btn btn-primary" onclick="abrirModalMedicamento()">
              <i class="fas fa-plus"></i> Novo
            </button>
          </header>
          <div class="table-container">
            <div style="margin-bottom: 15px">
              <input
                type="text"
                placeholder="Filtrar por nome, princípio ativo ou fabricante..."
                onkeyup="filtrarTabela(this.value)"
              />
            </div>
            <table>
              <thead>
                <tr>
                  <th>Nome Comercial</th>
                  <th>Princípio Ativo</th>
                  <th>Tipo</th>
                  <th>Preço</th>
                  <th>Estoque</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="lista-medicamentos"></tbody>
            </table>
          </div>
        </div>

        <!-- PDV -->
        <div id="screen-vendas" class="screen hidden">
          <header>
            <div class="header-title-group">
              <button
                class="btn"
                onclick="toggleSidebar()"
                style="background: none; border: 1px solid #ddd"
              >
                <i class="fas fa-bars"></i>
              </button>
              <h1>Caixa 01 - PDV</h1>
            </div>
            <span class="badge badge-no" style="font-size: 1rem"
              ><i class="fas fa-check-circle"></i> Operacional</span
            >
          </header>
          <div class="pdv-grid">
            <div class="pdv-left">
              <div class="table-container">
                <label
                  ><i class="fas fa-user"></i> Identificar Cliente
                  (Opcional)</label
                >
                <select id="venda-cliente">
                  <option value="Consumidor Final">Consumidor Final</option>
                  <option value="João Silva">
                    João Silva (CPF: 111.222.333-44)
                  </option>
                  <option value="Maria Oliveira">
                    Maria Oliveira (CPF: 555.666.777-88)
                  </option>
                </select>
              </div>
              <div class="table-container" style="position: relative">
                <label
                  ><i class="fas fa-search"></i> Buscar Produto (Código ou
                  Nome)</label
                >
                <input
                  type="text"
                  id="input-busca-pdv"
                  placeholder="Digite para buscar..."
                  onkeyup="buscarProduto(this.value)"
                  autocomplete="off"
                />
                <div id="resultado-busca" class="product-search-result"></div>
              </div>
              <div id="area-receita" class="hidden">
                <div class="receita-alert">
                  <i class="fas fa-file-medical-alt fa-2x"></i>
                  <div>
                    <strong>Retenção de Receita Obrigatória</strong><br />Item
                    controlado detectado. Informe os dados abaixo conforme
                    RDC/Anvisa.
                  </div>
                </div>
                <div class="table-container">
                  <h3>Dados da Prescrição</h3>
                  <div class="form-grid">
                    <div>
                      <label>CRM Médico *</label
                      ><input
                        type="text"
                        id="venda-crm"
                        placeholder="Ex: 12345/UF"
                      />
                    </div>
                    <div>
                      <label>Nome Médico</label
                      ><input type="text" id="venda-medico-nome" />
                    </div>
                    <div>
                      <label>Data Prescrição</label
                      ><input type="date" id="venda-data-receita" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pdv-right">
              <h3
                style="
                  border-bottom: 1px solid #eee;
                  padding-bottom: 10px;
                  margin-bottom: 10px;
                "
              >
                <i class="fas fa-shopping-cart"></i> Cupom
              </h3>
              <div class="cart-list" id="lista-carrinho">
                <p style="text-align: center; color: #999; margin-top: 40px">
                  Aguardando itens...
                </p>
              </div>
              <div style="margin-top: auto">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    font-size: 1.1rem;
                  "
                >
                  <span>Subtotal:</span
                  ><span>R$ <span id="valor-total">0,00</span></span>
                </div>
                <div class="total-box">
                  R$ <span id="valor-final">0,00</span>
                </div>
                <button
                  class="btn btn-primary"
                  style="
                    width: 100%;
                    justify-content: center;
                    padding: 15px;
                    font-size: 1.2rem;
                  "
                  onclick="finalizarVenda()"
                >
                  FINALIZAR (F2)
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- HISTORICO -->
        <div id="screen-historico" class="screen hidden">
          <header>
            <div class="header-title-group">
              <button
                class="btn"
                onclick="toggleSidebar()"
                style="background: none; border: 1px solid #ddd"
              >
                <i class="fas fa-bars"></i>
              </button>
              <h1>Histórico</h1>
            </div>
          </header>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Data/Hora</th>
                  <th>Cliente</th>
                  <th>Itens</th>
                  <th>Total</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="lista-historico"></tbody>
            </table>
          </div>
        </div>

        <!-- CADASTROS -->
        <div id="screen-cadastros" class="screen hidden">
          <header>
            <div class="header-title-group">
              <button
                class="btn"
                onclick="toggleSidebar()"
                style="background: none; border: 1px solid #ddd"
              >
                <i class="fas fa-bars"></i>
              </button>
              <h1>Cadastros</h1>
            </div>
          </header>
          <div class="form-grid">
            <div class="table-container">
              <h3><i class="fas fa-user-md"></i> Novo Médico</h3>
              <form
                onsubmit="
                  alert('Médico salvo!');
                  return false;
                "
              >
                <label>Nome Completo</label><input type="text" required /><label
                  >CRM / UF</label
                ><input type="text" required placeholder="12345/SP" /><label
                  >Especialidade</label
                ><input type="text" />
                <button class="btn btn-primary" style="margin-top: 10px">
                  Cadastrar
                </button>
              </form>
            </div>
            <div class="table-container">
              <h3><i class="fas fa-user"></i> Novo Cliente</h3>
              <form
                onsubmit="
                  alert('Cliente salvo!');
                  return false;
                "
              >
                <label>Nome Completo</label><input type="text" required /><label
                  >CPF</label
                ><input type="text" required /><label>Endereço</label
                ><input type="text" />
                <button class="btn btn-primary" style="margin-top: 10px">
                  Cadastrar
                </button>
              </form>
            </div>
          </div>
        </div>
      </main>
    </section>

    <!-- MODAIS -->
    <div id="modal-medicamento" class="modal-overlay hidden">
      <div class="modal">
        <div class="modal-header">
          <h3>Novo Medicamento</h3>
          <button class="btn btn-outline" onclick="fecharModalMedicamento()">
            X
          </button>
        </div>
        <form onsubmit="salvarMedicamento(event)">
          <label>Nome Comercial</label
          ><input
            type="text"
            id="med-nome"
            required
            placeholder="Ex: Losartana"
          />
          <div class="form-grid">
            <div>
              <label>Fabricante</label
              ><input type="text" id="med-fabricante" required />
            </div>
            <div>
              <label>Princípio Ativo</label
              ><input type="text" id="med-ativo" required />
            </div>
          </div>
          <div class="form-grid">
            <div>
              <label>Preço Venda (R$)</label
              ><input type="number" id="med-preco" step="0.01" required />
            </div>
            <div>
              <label>Estoque Inicial</label
              ><input type="number" id="med-estoque" required />
            </div>
          </div>
          <div
            style="
              margin: 15px 0;
              background: #fff3cd;
              padding: 10px;
              border-radius: 4px;
            "
          >
            <label
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                cursor: pointer;
              "
              ><input
                type="checkbox"
                id="med-receita"
                style="width: auto; margin: 0"
              /><b>Controlado:</b> Exige retenção de receita?</label
            >
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%">
            Salvar no Sistema
          </button>
        </form>
      </div>
    </div>

    <div id="modal-recibo" class="modal-overlay hidden">
      <div class="receipt-paper">
        <div style="text-align: center; margin-bottom: 20px">
          <h3 style="margin: 0">FARMÁCIA POPULAR</h3>
          <small>CNPJ: 00.000.000/0001-99</small><br /><small
            >Rua das Flores, 123 - Centro</small
          >
        </div>
        <div class="receipt-line"></div>
        <div id="recibo-itens"></div>
        <div class="receipt-line"></div>
        <div class="receipt-item" style="font-weight: bold; font-size: 1.1rem">
          <span>TOTAL</span><span id="recibo-total">R$ 0,00</span>
        </div>
        <div style="margin-top: 20px; text-align: center; font-size: 0.8rem">
          <p>Cliente: <span id="recibo-cliente">Consumidor</span></p>
          <p id="recibo-crm" class="hidden">
            CRM: <span id="recibo-crm-valor"></span>
          </p>
          <br />
          <p>Obrigado pela preferência!</p>
        </div>
        <button
          class="btn btn-primary"
          style="width: 100%; margin-top: 15px"
          onclick="fecharRecibo()"
        >
          Imprimir / Fechar
        </button>
      </div>
    </div>

    <script type="module" src="../dist/app/main.js"></script>
  </body>
</html>
